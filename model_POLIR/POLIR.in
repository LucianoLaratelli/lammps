units real
boundary p p p #all periodic
atom_style full
timestep .1 # femtoseconds (1e-15 s)

read_data single_water.xyz
#replicate 2 1 1
#read_data POLIR-post_100.init


#SELF TABULATED DATA-- VDW AND ANGLE TABLE WORK

pair_style table linear 600000                      ewald
pair_coeff 1 1   polir.table OO_VDW                           6.0
pair_coeff 1 2   polir.table OH_VDW                           6.0
pair_coeff 2 2   polir.table HH_VDW                           6.0

angle_style table linear 1001
angle_coeff 1 angle.table ANGLE1

#END SELF TABULATED DATA

bond_style morse
#command      BOND_ID      D      alpha           r_0
bond_coeff    1            240.0  2.58794976      0.958649

#HARMONIC IS DEPRECATED BUT LEFT HERE FOR TESTING
#angle_style harmonic
#angle_coeff angle ID  E, a constant    equilibrium bond distance
#angle_coeff  1         68.087           104.51
#END HARMONIC


dump Dump all atom 1 lammps_traj.lammpstrj
dump_modify Dump sort id
dump_modify Dump scale no

thermo_style multi
thermo 1


dump Forces all custom 1 forces.dump id type fx fy fz


compute cc1 all chunk/atom molecule
compute myChunk all dipole/chunk cc1

variable chunk_dipole_x equal sum(c_myChunk[1])
variable chunk_dipole_y equal sum(c_myChunk[2])
variable chunk_dipole_z equal sum(c_myChunk[3])

variable total_chunk_dipole equal v_chunk_dipole_x+v_chunk_dipole_y+v_chunk_dipole_z

variable t equal step*.01
variable d equal v_total_chunk_dipole

fix dipoles_print all print 1 "$t $d" file total_dipoles.out screen no

fix 4 all ave/correlate 1 1 1 v_total_chunk_dipole type full ave running file mu_correlated.out

#fix run all nvt temp 10 300 1000
fix run all nve
run 200000
write_data POLIR-post.init nocoeff
quit